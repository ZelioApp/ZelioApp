<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ZELIO - Solution Devis √âlectricit√©</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
:root { --primary: #4f46e5; --bg: #f1f5f9; --card: #ffffff; --text: #1f2937; --accent: #10b981; }
* { box-sizing: border-box; }
body { margin: 0; font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding-bottom: 140px; }

/* Header & Logo */
.header-brand { background: white; padding: 1.5rem; text-align: center; border-bottom: 1px solid #e2e8f0; }
.logo-text { font-size: 2.5rem; font-weight: 900; color: var(--primary); letter-spacing: -2px; margin: 0; }
.logo-subtitle { font-size: 0.8rem; color: #64748b; text-transform: uppercase; letter-spacing: 2px; margin-top: -5px; }

/* Navigation */
.nav-tabs { display: flex; justify-content: center; gap: 10px; background: white; padding: 0.8rem; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
.tab-btn { padding: 0.7rem 1.1rem; border: none; background: #e2e8f0; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.9rem; }
.tab-btn.active { background: var(--primary); color: white; }

.container { max-width: 1100px; margin: auto; padding: 1rem; }
.page { display: none; }
.page.active { display: block; }

/* Formulaires */
.form-section { background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; border: 1px solid #e2e8f0; }
.form-section h2 { margin-top: 0; font-size: 1.1rem; color: var(--primary); margin-bottom: 1rem; }
.grid-forms { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1rem; }
.form-group label { display: block; font-size: 0.75rem; font-weight: bold; margin-bottom: 4px; color: #64748b; }
input.full-width { width: 100%; padding: 0.7rem; border-radius: 8px; border: 1px solid #cbd5e1; font-size: 0.9rem; }

/* Accord√©on */
.accordion-controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 1rem; }
.btn-small { padding: 6px 12px; font-size: 0.75rem; background: #cbd5e1; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
.btn-danger { background: #fee2e2; color: #ef4444; }

.accordion-item { background: var(--card); border-radius: 12px; margin-bottom: 0.6rem; overflow: hidden; border: 1px solid #e2e8f0; }
.accordion-header { width: 100%; padding: 1.1rem; background: white; border: none; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: bold; text-align: left; }
.accordion-header::after { content: '+'; color: var(--primary); font-size: 1.2rem; }
.accordion-item.open .accordion-header { border-bottom: 1px solid #f1f5f9; color: var(--primary); }
.accordion-item.open .accordion-header::after { content: '-'; }
.accordion-content { display: none; padding: 1rem; background: #fafafa; }
.accordion-item.open .accordion-content { display: block; }

.grid-items { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 0.7rem; }
.item { display: flex; align-items: center; justify-content: space-between; background: white; padding: 0.6rem 0.9rem; border-radius: 8px; border: 1px solid #e2e8f0; }
.item label { font-size: 0.85rem; flex: 1; margin-right: 10px; }
select, input[type="number"] { width: 70px; padding: 0.4rem; border-radius: 6px; border: 1px solid #cbd5e1; }

/* Footer */
.footer { position: fixed; bottom: 0; width: 100%; background: white; padding: 1rem; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -5px 15px rgba(0,0,0,0.1); z-index: 1001; }
.total-amount { font-size: 1.5rem; font-weight: 800; color: var(--primary); }
.btn-generate { background: var(--primary); color: white; padding: 0.9rem 2rem; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }
</style>
</head>
<body>

<div class="header-brand">
    <h1 class="logo-text">ZELIO</h1>
    <div class="logo-subtitle">Logiciel de Chiffrage √âlectrique Professionnel</div>
</div>

<div class="nav-tabs">
  <button class="tab-btn active" onclick="showPage('config')">üìã Devis</button>
  <button class="tab-btn" onclick="showPage('prices')">‚öôÔ∏è Param√®tres</button>
</div>

<div class="container">
  <div id="page-config" class="page active">
    <div class="form-section">
      <h2>üë§ Informations Client & Chantier</h2>
      <div class="grid-forms">
        <div class="form-group"><label>Nom du Client</label><input type="text" id="c-name" class="full-width" placeholder="Ex: Jean Dupont"></div>
        <div class="form-group"><label>T√©l√©phone</label><input type="text" id="c-phone" class="full-width" placeholder="06 00 00 00 00"></div>
        <div class="form-group"><label>Email</label><input type="email" id="c-email" class="full-width" placeholder="client@email.com"></div>
        <div class="form-group"><label>Adresse de Facturation</label><input type="text" id="c-addr" class="full-width" placeholder="Adresse compl√®te"></div>
        <div class="form-group"><label>Adresse du Chantier</label><input type="text" id="c-site" class="full-width" placeholder="Si diff√©rente"></div>
        <div class="form-group"><label>Type de bien</label><input type="text" id="c-type" class="full-width" placeholder="Ex: Maison T4"></div>
      </div>
    </div>
    
    <div class="accordion-controls">
        <button class="btn-small" onclick="toggleAll(true)">Tout ouvrir</button>
        <button class="btn-small" onclick="toggleAll(false)">Tout fermer</button>
        <button class="btn-small btn-danger" onclick="resetQuantities()">Vider le panier</button>
    </div>

    <div id="config-accordion"></div>
  </div>

  <div id="page-prices" class="page">
    <div class="form-section">
        <h2>üõ†Ô∏è Mes Informations Artisan</h2>
        <div class="grid-forms">
            <div class="form-group"><label>Nom Entreprise / Nom</label><input type="text" id="my-name" class="full-width"></div>
            <div class="form-group"><label>SIRET</label><input type="text" id="my-siret" class="full-width"></div>
            <div class="form-group"><label>Adresse Pro</label><input type="text" id="my-addr" class="full-width"></div>
            <div class="form-group"><label>Assurance D√©cennale</label><input type="text" id="my-ins" class="full-width"></div>
        </div>
        <button class="btn-small btn-danger" style="margin-top:20px;" onclick="fullReset()">‚ö†Ô∏è R√©initialiser TOUTE la base de donn√©es</button>
    </div>
    <div id="prices-accordion"></div>
  </div>
</div>

<div class="footer">
  <div>Total HT : <span class="total-amount"><span id="grand-total">0</span>‚Ç¨</span></div>
  <button class="btn-generate" onclick="generatePDF()">G√âN√âRER LE DEVIS</button>
</div>

<script>
const defaultDatabase = {
  "‚ö° √âclairage Int√©rieur": {
    "Spot encastr√© LED": 45, "Spot en saillie": 50, "Spot orientable": 55, "Plafonnier": 65, "Suspension": 75, "Applique murale": 55, "R√©glette LED garage": 45, "Ruban LED (ml)": 25, "Profil√© Alu pour LED": 30, "Variateur de lumi√®re": 50, "D√©tecteur de pr√©sence": 95, "Transformateur LED": 35
  },
  "üîå Prises & Interrupteurs": {
    "Prise de courant 16A": 35, "Prise √©tanche IP55": 45, "Prise USB (A+C)": 60, "Prise RJ45 Cat6": 65, "Prise TV / Satellite": 45, "Interrupteur simple": 25, "Va-et-vient": 35, "Bouton poussoir": 32, "Double va-et-vient": 45, "Sortie de c√¢ble": 20
  },
  "üßØ C√¢blage & Cheminement": {
    "C√¢ble 3G1.5 (ml)": 3, "C√¢ble 3G2.5 (ml)": 4, "C√¢ble RJ45 (ml)": 4.5, "Gaine ICTA √ò20 (ml)": 2.5, "Gaine ICTA √ò25 (ml)": 3, "Goulotte 20x12 (ml)": 12, "Goulotte 40x20 (ml)": 18, "Bo√Æte de d√©rivation": 15
  },
  "üì¶ Tableaux & Protections": {
    "Tableau √©lectrique nu": 150, "Disjoncteur 10A/16A": 25, "Disjoncteur 20A/32A": 35, "Interrupteur Diff√©rentiel 40A": 95, "Interrupteur Diff√©rentiel 63A": 130, "Disjoncteur diff√©rentiel": 115, "Parafoudre": 170, "Contacteur Jour/Nuit": 85, "T√©l√©rupteur": 70, "Bornier de terre": 15
  },
  "üè† Domotique & Connect√©": {
    "Micromodule volet roulant": 85, "Micromodule √©clairage": 80, "Pack d√©marrage connect√©": 180, "Thermostat connect√©": 230, "Capteur ouverture fen√™tre": 55, "Passerelle Wifi/Zigbee": 110
  },
  "üö™ Ouvertures Automatis√©es": {
    "Moteur volet roulant": 290, "Motorisation portail battant": 980, "Motorisation portail coulissant": 1100, "Cellule de s√©curit√©": 90, "Feu clignotant orange": 75, "Antenne d√©port√©e": 45
  },
  "üî• Chauffage & Ventilation": {
    "Radiateur √† inertie 1000W": 390, "Radiateur √† inertie 2000W": 550, "S√®che-serviette": 450, "VMC simple flux": 550, "VMC double flux": 2900, "Extracteur ponctuel": 130, "Bouche d'extraction": 35
  },
  "üîî S√©curit√© & Communication": {
    "Centrale Alarme": 550, "Sir√®ne ext√©rieure": 180, "D√©tecteur fum√©e": 45, "Visiophone connect√©": 490, "Interphone audio": 260, "Cam√©ra IP ext√©rieure": 350, "Baie de brassage": 420
  },
  "üß∞ Prestations & Main d'≈ìuvre": {
    "Heure de main d'≈ìuvre": 55, "Forfait d√©placement": 50, "Mise en conformit√© tableau": 850, "Saign√©e dans b√©ton (ml)": 40, "Recherche de panne": 90, "Consuel (frais + dossier)": 250
  }
};

let database = JSON.parse(localStorage.getItem('zelio_full_v4')) || defaultDatabase;

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  event.currentTarget.classList.add('active');
}

function toggleAccordion(header) { header.parentElement.classList.toggle('open'); }
function toggleAll(show) { document.querySelectorAll('.accordion-item').forEach(item => show ? item.classList.add('open') : item.classList.remove('open')); }
function resetQuantities() { if(confirm("R√©initialiser toutes les quantit√©s √† 0 ?")) { document.querySelectorAll('.qty-in').forEach(s => s.value = 0); calculate(); } }
function fullReset() { if(confirm("Voulez-vous supprimer tous vos prix personnalis√©s et revenir √† la liste d'origine ?")) { localStorage.removeItem('zelio_full_v4'); location.reload(); } }

function render() {
  const configA = document.getElementById('config-accordion');
  const pricesA = document.getElementById('prices-accordion');
  configA.innerHTML = ''; pricesA.innerHTML = '';

  for (const [cat, prods] of Object.entries(database)) {
    const catId = cat.replace(/[^\w]/g, '');
    configA.innerHTML += `<div class="accordion-item"><button class="accordion-header" onclick="toggleAccordion(this)">${cat}</button><div class="accordion-content"><div class="grid-items" id="c-${catId}"></div></div></div>`;
    pricesA.innerHTML += `<div class="accordion-item"><button class="accordion-header" onclick="toggleAccordion(this)">Modifier Tarifs : ${cat}</button><div class="accordion-content"><div class="grid-items" id="p-${catId}"></div></div></div>`;

    for (const [name, price] of Object.entries(prods)) {
      document.getElementById(`c-${catId}`).innerHTML += `<div class="item"><label>${name}</label><select class="qty-in" data-cat="${cat}" data-prod="${name}">${Array.from({length:101},(_,i)=>`<option value="${i}">${i}</option>`).join('')}</select></div>`;
      document.getElementById(`p-${catId}`).innerHTML += `<div class="item"><label>${name}</label><input type="number" value="${price}" class="price-in" data-cat="${cat}" data-prod="${name}"></div>`;
    }
  }
  document.querySelectorAll('.qty-in, .price-in').forEach(el => el.addEventListener('input', calculate));
}

function calculate() {
  let total = 0;
  document.querySelectorAll('.price-in').forEach(i => { database[i.dataset.cat][i.dataset.prod] = parseFloat(i.value) || 0; });
  localStorage.setItem('zelio_full_v4', JSON.stringify(database));
  document.querySelectorAll('.qty-in').forEach(s => { total += parseInt(s.value) * database[s.dataset.cat][s.dataset.prod]; });
  document.getElementById('grand-total').innerText = total.toLocaleString();
}

function generatePDF() {
  const c = { name: document.getElementById('c-name').value, phone: document.getElementById('c-phone').value, email: document.getElementById('c-email').value, addr: document.getElementById('c-addr').value, site: document.getElementById('c-site').value, type: document.getElementById('c-type').value };
  const m = { name: document.getElementById('my-name').value, siret: document.getElementById('my-siret').value, addr: document.getElementById('my-addr').value, ins: document.getElementById('my-ins').value };
  
  let rows = "";
  document.querySelectorAll('.qty-in').forEach(s => {
    const q = parseInt(s.value);
    if(q > 0) {
      const p = database[s.dataset.cat][s.dataset.prod];
      rows += `<tr><td style="padding:10px; border-bottom:1px solid #eee;">${s.dataset.prod}</td><td style="text-align:center; border-bottom:1px solid #eee;">${q}</td><td style="text-align:right; border-bottom:1px solid #eee;">${p}‚Ç¨</td><td style="text-align:right; border-bottom:1px solid #eee;">${q*p}‚Ç¨</td></tr>`;
    }
  });

  if(!rows) return alert("Le devis est vide !");

  const element = document.createElement('div');
  element.style.padding = "40px";
  element.style.fontFamily = "sans-serif";
  element.innerHTML = `
    <div style="display:flex; justify-content:space-between; border-bottom:3px solid #4f46e5; padding-bottom:15px; margin-bottom:25px;">
        <div><h1 style="color:#4f46e5; margin:0;">${m.name || 'DEVIS √âLECTRIQUE'}</h1><p style="font-size:12px; margin-top:5px;">SIRET: ${m.siret}<br>${m.addr}</p></div>
        <div style="text-align:right;"><h2>DEVIS N¬∞ ${Math.floor(Math.random()*1000)}</h2><p>Date: ${new Date().toLocaleDateString()}</p></div>
    </div>
    <div style="display:flex; justify-content:space-between; margin-bottom:35px; font-size:14px;">
        <div style="width:48%; background:#f8fafc; padding:20px; border-radius:10px;">
            <strong style="color:#4f46e5;">CLIENT :</strong><br>${c.name}<br>${c.addr}<br>T√©l: ${c.phone}<br>${c.email}
        </div>
        <div style="width:48%; border:1px solid #e2e8f0; padding:20px; border-radius:10px;">
            <strong style="color:#4f46e5;">D√âTAILS CHANTIER :</strong><br>Type: ${c.type}<br>Lieu: ${c.site || c.addr}
        </div>
    </div>
    <table style="width:100%; border-collapse:collapse; font-size:13px;">
        <tr style="background:#4f46e5; color:white;">
            <th style="padding:12px; text-align:left;">D√©signation</th><th style="padding:12px;">Qt√©</th><th style="padding:12px; text-align:right;">PU HT</th><th style="padding:12px; text-align:right;">Total HT</th>
        </tr>
        ${rows}
    </table>
    <div style="text-align:right; margin-top:40px;">
        <p style="margin:5px 0;">Total HT : ${document.getElementById('grand-total').innerText} ‚Ç¨</p>
        <p style="margin:5px 0;">TVA (20%) : ${(parseFloat(document.getElementById('grand-total').innerText.replace(/\s/g,''))*0.2).toFixed(2)} ‚Ç¨</p>
        <h2 style="color:#4f46e5; margin-top:10px;">TOTAL TTC : ${(parseFloat(document.getElementById('grand-total').innerText.replace(/\s/g,''))*1.2).toFixed(2)} ‚Ç¨</h2>
    </div>
    <div style="margin-top:50px; font-size:11px; color:#666; border-top:1px solid #eee; padding-top:15px;">
        <p><strong>Conditions :</strong> Valable 30 jours. Assurance D√©cennale : ${m.ins}</p>
        <p style="margin-top:20px;">Bon pour accord le : ____ / ____ / 20____ &nbsp;&nbsp;&nbsp; Cachet et Signature :</p>
    </div>
  `;

  html2pdf().from(element).set({ margin: 0.5, filename: `Devis_ZELIO_${c.name}.pdf`, html2canvas: { scale: 2 } }).save();
}

render();
</script>
</body>
</html>